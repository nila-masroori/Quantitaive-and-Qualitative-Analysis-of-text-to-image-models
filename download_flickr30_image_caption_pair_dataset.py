# -*- coding: utf-8 -*-
"""download Flickr30 image-caption pair dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Q8OteEw48PzrLlA7p9DZzYwduIjnySCR
"""

!pip install kaggle

"""setup the kaggle's API"""

!mkdir -p ~/.kaggle
!mv /content/kaggle.json ~/.kaggle/

# Set the required permissions for the kaggle.json file
!chmod 600 ~/.kaggle/kaggle.json

!kaggle datasets download hsankesara/flickr-image-dataset

# Unzip the downloaded file
!unzip flickr-image-dataset.zip

from google.colab import drive
drive.mount('/content/drive')

"""Move the dataset to drive"""

import shutil

source_folder = '/content/flickr30k_images' #  the path to your downloaded folder in Colab
destination_folder = '/content/drive/MyDrive/Project-AML' # Replace with the desired path in your Google Drive

shutil.move(source_folder, destination_folder)

import os

listt=os.listdir("/content/drive/MyDrive/Project-AML/flickr30k_images/flickr30k_images")

len(listt)

"""Each image has a name like an ID which is assigned to its caption inside the results.csv file."""

path="/content/drive/MyDrive/Project-AML/flickr30k_images/results.csv"

"""Reading the csv file of all the image caption pairs of Flickr30 dataset"""

import pandas as pd
import numpy as np
df=pd.read_csv(path,usecols=["image_name| comment_number| comment"])
print("The dataframe is:")
print(df)

df["image_name| comment_number| comment"][0].split("|")[2]

len(df)

dictt={}#creating a dictionary from image ids as keys and captions as values

import re

for caption in df["image_name| comment_number| comment"]:
  if (len(caption.split("|"))==3):
    dictt[caption.split("|")[0]]=caption.split("|")[2].split('.')[0]

  else:
    dictt[caption.split("|")[0]]=caption.split("|")[1].split('.')[0]

"dictt['1000092795.jpg']

dictt.values()

image_list=[]
caption_list=[]
os.chdir("/content")

#this function searches for a word in dictonary values and will return keys and values containing that word
def search(values, searchFor):
  for k in values:
      if searchFor in values[k]:
        image_list.append(k)
        caption_list.append(values[k])
        # #write the captions in a text file
        # with open('Flickr30_motion_captions.txt', 'a') as f:
        #   f.write(values[k]+"\n")
  return image_list

#filtering the image captions to get motion captions and images
#words_of_interest = ['running', 'swimming', 'riding', 'falling', 'throwing', 'jumping', 'walking', 'chasing',
                    #  "dancing","playing","skipping","moving","hopping","leaping","punching","lifting","shaking","bouncing","spinning","swinging",
                    #  "flying","clapping","streching","tapping","striking","crawling","skiing","jogging","rowings","rolling","climbing",
                    #  "hiking","jogging","dancing","sprinting","skating","gliding","sliding","roller blading","rollerblading","snow boarding","marching","diving","sledding","Canoeing","kayaking","skydiving"]
#face captions and images
words_of_interest=["person","boy","girl","he","she","they","people","human","kid","children","nurse","doctor","engineer","student","professor","researcher","people","lawyer","plumber","athlete"]
img_list,cap_list=[],[]
for word in words_of_interest:
 img_list=search(dictt,word)

pwd

# Import the necessary libraries
import cv2
import os

#saving the images in the list img_list in a folder
for img in img_list: #look for the imgs in the list of all images in the dataset
  # os.listdir(path).index(img)

  # Set the file path for the source image
  path = "/content/drive/MyDrive/Project-AML/flickr30k_images/flickr30k_images/"+img
  # Set the directory for saving the image
  directory = r'/content/drive/MyDrive/Project-AML/flickr30k_images/face_images'

  # Load the image using OpenCV
  image = cv2.imread(path)
  if image is None:
        print(f"Failed to read image: {img}")
        continue

  # Change the working directory to the specified directory for saving the image
  os.chdir(directory)

  # Print the list of files in the directory before saving the image
  # print("Before saving")
  # print(os.listdir(directory))

  # Save the image with the filename "cat.jpg"
  filename = dictt[img]+".jpg" #save the image with the caption title
  print(filename)
  cv2.imwrite(filename, image)

  # Print the list of files in the directory after saving the image
  # print("After saving")
  # print(os.listdir(directory))

"""Number of motion/face images"""

len(os.listdir('/content/drive/MyDrive/Project-AML/flickr30k_images/face_images'))

# with open("/content/Flickr30_motion_captions.txt","r") as f:
#   lines=f.readlines()
# len(lines)

"""Creating the list of motion captions"""

os.chdir("/content")

for img in os.listdir('/content/drive/MyDrive/Project-AML/flickr30k_images/face_images'):
  with open ("Flickr30_captions_faces.txt","a") as f:
    f.write(img.split(".")[0]+"\n")

pwd

with open("/content/Flickr30_captions_faces.txt","r") as f:
  lines=f.readlines()
len(lines)

